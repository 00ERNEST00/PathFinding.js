var PF=PF||{};PF.Node=function(a,b){this.x=a,this.y=b,this.walkable=!0,this.parent=null},PF.Node.prototype.constructor=PF.Node,PF.Node.prototype.set=function(a,b){this[a]=b},PF.Node.prototype.get=function(a){return this[a]},PF.Grid=function(a,b,c){this.width=a,this.height=b,this.nodes=[],this._buildGrid(c)},PF.Grid.prototype._buildGrid=function(a){var b,c,d=this.width,e=this.height,f=[],g;for(b=0;b<e;++b){f.push([]),g=f[b];for(c=0;c<d;++c)g.push(new PF.Node(c,b))}this.nodes=f;if(a===undefined)return;if(a.length!=e||a[0].length!=d)throw new Error("Matrix size does not fit");for(b=0;b<e;++b)for(c=0;c<d;++c)a[b][c]&&(f[b][c].walkable=!1)},PF.Grid.prototype.getNodeAt=function(a,b){return this.nodes[b][a]},PF.Grid.prototype.isWalkableAt=function(a,b){return this.getNodeAt(a,b).get("walkable")},PF.Grid.prototype.setWalkableAt=function(a,b,c){this.getNodeAt(a,b).set("walkable",c)},PF.Grid.prototype.isInside=function(a,b){return a>=0&&a<this.width&&b>=0&&b<this.height},PF.Grid.prototype.setAttributeAt=function(a,b,c,d){this.getNodeAt(a,b).set(c,d)},PF.Grid.prototype.getAttributeAt=function(a,b,c){return this.getNodeAt(a,b).get(c)},PF.BaseFinder=function(a){this.startX=null,this.startY=null,this.endX=null,this.endY=null,this.grid=null,this.gridHeight=null,this.gridWidth=null,this.allowDiagonal=a},PF.BaseFinder.prototype.isInsideGrid=function(a,b){return this.grid.isInside(a,b)},PF.BaseFinder.prototype.setWalkableAt=function(a,b,c){this.grid.setWalkableAt(a,b,c)},PF.BaseFinder.prototype.isWalkableAt=function(a,b){return this.grid.isWalkableAt(a,b)},PF.BaseFinder.prototype.setAttributeAt=function(a,b,c,d){this.grid.setAttributeAt(a,b,c,d)},PF.BaseFinder.prototype.getAttributeAt=function(a,b,c){return this.grid.getAttributeAt(a,b,c)},PF.BaseFinder.prototype.constructor=PF.BaseFinder,PF.BaseFinder.prototype.findPath=function(a,b,c,d,e){return this.startX=a,this.startY=b,this.endX=c,this.endY=d,this.grid=e,this.gridWidth=e.width,this.gridHeight=e.height,this._find()},PF.BaseFinder.prototype._constructPath=function(){var a=this.startX,b=this.startY,c,d,e=this.grid,f=[[this.endX,this.endY]];for(;;){c=f[0][0],d=f[0][1];if(c==a&&d==b)return f;f.unshift(e.getAttributeAt(c,d,"parent"))}return[]},PF.BaseFinder.prototype._find=function(){throw new Error("Sub-classes must implement this method")},PF.BaseFinder.xOffsets=[-1,0,1,0],PF.BaseFinder.yOffsets=[0,1,0,-1],PF.BaseFinder.xDiagonalOffsets=[-1,-1,1,1],PF.BaseFinder.yDiagonalOffsets=[-1,1,1,-1],PF.Heap=function(a){this._cmp=a||function(a,b){return a<b},this._heap=[]},PF.Heap.prototype.top=function(){return this._heap[0]},PF.Heap.prototype.size=function(){return this._heap.length},PF.Heap.prototype.isEmpty=function(){return!this.size()},PF.Heap.prototype.push=function(a){this._heap.push(a),this._siftDown(0,this._heap.length-1)},PF.Heap.prototype.pop=function(){var a,b,c;return a=this._heap,b=a.pop(),a.length?(c=a[0],a[0]=b,this._siftUp(0)):c=b,c},PF.Heap.prototype.replace=function(a){var b=this._heap[0];return this._heap[0]=a,this._siftUp(0),b},PF.Heap.prototype.pushpop=function(a){var b=this._heap,c;return b.length&&this._cmp(b[0],a)&&(c=b[0],b[0]=a,a=c,this._siftUp(0)),a},PF.Heap.prototype.heapify=function(){var a,b=this._heap.length;for(a=Math.floor(b/2)-1;a>=0;--a)this._siftUp(a)},PF.Heap.prototype._siftDown=function(a,b){var c,d,e,f,g;c=this._heap,d=this._cmp,e=c[b];while(b>a){f=b-1>>1,g=c[f];if(d(e,g)){c[b]=g,b=f;continue}break}c[b]=e},PF.Heap.prototype._siftUp=function(a){var b,c,d,e,f,g,h;c=this._cmp,b=this._heap,d=b.length,e=a,f=b[a],g=2*a+1;while(g<d)h=g+1,h<d&&!c(b[g],b[h])&&(g=h),b[a]=b[g],a=g,g=2*a+1;b[a]=f,this._siftDown(e,a)},PF.AStarFinder=function(a,b){PF.BaseFinder.call(this,a),a&&(this._inspectSurround=this._inspectSurroundDiagonal),this.heuristic=b||PF.AStarFinder.manhattan},PF.AStarFinder.prototype=new PF.BaseFinder,PF.AStarFinder.prototype.constructor=PF.AStarFinder,PF.AStarFinder.prototype._find=function(){var a,b,c=this.startX,d=this.startY,e=this.endX,f=this.endY,g=this.grid,h=new PF.Heap(function(a,b){var c=g.getAttributeAt(a[0],a[1],"f"),d=g.getAttributeAt(b[0],b[1],"f");return c!=d?c<d:g.getAttributeAt(a[0],a[1],"h")<g.getAttributeAt(b[0],b[1],"h")}),i;this.openList=h,i=g.getNodeAt(c,d),i.set("g",0),i.set("f",0),h.push([c,d]),i.set("opened",!0);while(!h.isEmpty()){pos=h.pop(),a=pos[0],b=pos[1],g.setAttributeAt(a,b,"closed",!0);if(a==e&&b==f)return this._constructPath();this._inspectSurround(a,b)}return[]},PF.AStarFinder.prototype._inspectNodeAt=function(a,b,c,d,e){var f=this.grid,g=this.openList,h=f.getNodeAt(a,b);if(h.get("closed"))return;h.get("opened")?this._tryUpdate(a,b,c,d,e)&&g.heapify():(h.set("opened",!0),this._tryUpdate(a,b,c,d,e),g.push([a,b]))},PF.AStarFinder.prototype._tryUpdate=function(a,b,c,d,e){var f=this.grid,g=f.getNodeAt(c,d),h=g.get("g")+(e?1.4142:1);return node=f.getNodeAt(a,b),node.get("g")===undefined||h<node.get("g")?(node.set("parent",[c,d]),node.set("g",h),node.set("h",this._calculateH(a,b)),node.set("f",node.get("g")+node.get("h")),!0):!1},PF.AStarFinder.prototype._calculateH=function(a,b){var c=Math.abs(a-this.endX),d=Math.abs(b-this.endY);return this.heuristic(c,d)},PF.AStarFinder.manhattan=function(a,b){return a+b},PF.AStarFinder.euclidean=function(a,b){return Math.sqrt(a*a+b*b)},PF.AStarFinder.chebyshev=function(a,b){return Math.max(a,b)},PF.AStarFinder.prototype._inspectSurround=function(a,b){var c=PF.BaseFinder.xOffsets,d=PF.BaseFinder.yOffsets,e=this.grid,f,g,h;for(f=0;f<c.length;++f)g=a+c[f],h=b+d[f],e.isInside(g,h)&&e.isWalkableAt(g,h)&&this._inspectNodeAt(g,h,a,b,!1)},PF.AStarFinder.prototype._inspectSurroundDiagonal=function(a,b){var c=PF.BaseFinder.xOffsets,d=PF.BaseFinder.yOffsets,e=PF.BaseFinder.xDiagonalOffsets,f=PF.BaseFinder.yDiagonalOffsets,g=this.grid,h,i,j,k=[];for(h=0;h<c.length;++h)i=a+c[h],j=b+d[h],g.isInside(i,j)&&g.isWalkableAt(i,j)&&(this._inspectNodeAt(i,j,a,b,!1),k.push(h));for(h=0;h<k.length;++h)i=a+e[k[h]],j=b+f[k[h]],g.isInside(i,j)&&g.isWalkableAt(i,j)&&this._inspectNodeAt(i,j,a,b,!0)},PF.BreadthFirstFinder=function(a){PF.BaseFinder.call(this),a&&(this._inspectSurround=this._inspectSurroundDiagonal)},PF.BreadthFirstFinder.prototype=new PF.BaseFinder,PF.BreadthFirstFinder.prototype.constructor=PF.BreadthFirstFinder,PF.BreadthFirstFinder.prototype._find=function(){var a=[],b,c,d,e,f,g=this.startX,h=this.startY,i=this.endX,j=this.endY,k=this.grid;this.openList=a,a.push([g,h]),k.setAttributeAt(g,h,"opened",!0);while(a.length){b=a.shift(),c=b[0],d=b[1],k.setAttributeAt(c,d,"closed",!0);if(c==i&&d==j)return this._constructPath();this._inspectSurround(c,d)}return[]},PF.BreadthFirstFinder.prototype._inspectNodeAt=function(a,b,c,d){var e=this.grid,f=e.getNodeAt(a,b);if(f.get("closed")||f.get("opened"))return;this.openList.push([a,b]),e.setAttributeAt(a,b,"opened",!0),e.setAttributeAt(a,b,"parent",[c,d])},PF.BreadthFirstFinder.prototype._inspectSurround=function(a,b){var c=PF.BaseFinder.xOffsets,d=PF.BaseFinder.yOffsets,e=this.grid,f,g,h;for(f=0;f<c.length;++f)g=a+c[f],h=b+d[f],e.isInside(g,h)&&e.isWalkableAt(g,h)&&this._inspectNodeAt(g,h,a,b)},PF.BreadthFirstFinder.prototype._inspectSurroundDiagonal=function(a,b){var c=PF.BaseFinder.xOffsets,d=PF.BaseFinder.yOffsets,e=PF.BaseFinder.xDiagonalOffsets,f=PF.BaseFinder.yDiagonalOffsets,g=this.grid,h,i,j,k=[];for(h=0;h<c.length;++h)i=a+c[h],j=b+d[h],g.isInside(i,j)&&g.isWalkableAt(i,j)&&(this._inspectNodeAt(i,j,a,b),k.push(h));for(h=0;h<k.length;++h)i=a+e[k[h]],j=b+f[k[h]],g.isInside(i,j)&&g.isWalkableAt(i,j)&&this._inspectNodeAt(i,j,a,b)},PF.BestFirstFinder=function(a,b){PF.AStarFinder.call(this,a,b);var c=this.heuristic;this.heuristic=function(a,b){return c(a,b)*1e6}},PF.BestFirstFinder.prototype=new PF.AStarFinder,PF.BestFirstFinder.prototype.constructor=PF.BestFirstFinder,PF.DijkstraFinder=function(a){PF.AStarFinder.call(this,a,function(a,b){return 0})},PF.DijkstraFinder.prototype=new PF.AStarFinder,PF.DijkstraFinder.prototype.constructor=PF.DijkstraFinder