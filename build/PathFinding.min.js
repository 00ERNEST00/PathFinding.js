var PF=PF||{};PF.Node=function(a,b){this.x=a,this.y=b,this.walkable=!0,this.parent=null},PF.Grid=function(a,b,c){this.width=a,this.height=b,this.nodes=[],this._buildGrid(c)},PF.Grid.prototype._buildGrid=function(a){var b,c,d=this.width,e=this.height,f=[],g;for(b=0;b<e;++b){f.push([]),g=f[b];for(c=0;c<d;++c)g.push(new PF.Node(c,b))}this.nodes=f;if(a===undefined)return;if(a.length!=e||a[0].length!=d)throw new Error("Matrix size does not fit");for(b=0;b<e;++b)for(c=0;c<d;++c)a[b][c]&&(f[b][c].walkable=!1)},PF.Grid.prototype.getNodeAt=function(a,b){return this.nodes[b][a]},PF.Grid.prototype.isWalkableAt=function(a,b){return this.getNodeAt(a,b).walkable},PF.Grid.prototype.setWalkableAt=function(a,b,c){this.getNodeAt(a,b).walkable=c},PF.Grid.prototype.isInside=function(a,b){return a>=0&&a<this.width&&b>=0&&b<this.height},PF.Grid.prototype.setAttributeAt=function(a,b,c,d){this.getNodeAt(a,b)[c]=d},PF.Grid.prototype.getAttributeAt=function(a,b,c){return this.getNodeAt(a,b)[c]},PF.BaseFinder=function(){this.startX=null,this.startY=null,this.endX=null,this.endY=null,this.grid=null,this.gridHeight=null,this.gridWidth=null},PF.BaseFinder.prototype.init=function(a,b,c,d,e){this.startX=a,this.startY=b,this.endX=c,this.endY=d,this.grid=e,this.gridWidth=e.width,this.gridHeight=e.height},PF.BaseFinder.prototype.isInsideGrid=function(a,b){return this.grid.isInside(a,b)},PF.BaseFinder.prototype.setWalkableAt=function(a,b,c){this.grid.setWalkableAt(a,b,c)},PF.BaseFinder.prototype.isWalkableAt=function(a,b){return this.grid.isWalkableAt(a,b)},PF.BaseFinder.prototype.setAttributeAt=function(a,b,c,d){this.grid.setAttributeAt(a,b,c,d)},PF.BaseFinder.prototype.getAttributeAt=function(a,b,c){return this.grid.getAttributeAt(a,b,c)},PF.BaseFinder.prototype.constructor=PF.BaseFinder,PF.BaseFinder.prototype.findPath=function(){throw new Error("Not Implemented Error: Sub-classes must implement this method")},PF.Heap=function(a){this._cmp=a||function(a,b){return a<b},this._heap=[]},PF.Heap.prototype.top=function(){return this._heap[0]},PF.Heap.prototype.size=function(){return this._heap.length},PF.Heap.prototype.isEmpty=function(){return!this.size()},PF.Heap.prototype.push=function(a){this._heap.push(a),this._siftDown(0,this._heap.length-1)},PF.Heap.prototype.pop=function(){var a,b,c;return a=this._heap,b=a.pop(),a.length?(c=a[0],a[0]=b,this._siftUp(0)):c=b,c},PF.Heap.prototype.replace=function(a){var b=this._heap[0];return this._heap[0]=a,this._siftUp(0),b},PF.Heap.prototype.pushpop=function(a){var b=this._heap,c;return b.length&&this._cmp(b[0],a)&&(c=b[0],b[0]=a,a=c,this._siftUp(0)),a},PF.Heap.prototype._siftDown=function(a,b){var c,d,e,f,g;c=this._heap,d=this._cmp,e=c[b];while(b>a){f=b-1>>1,g=c[f];if(d(e,g)){c[b]=g,b=f;continue}break}c[b]=e},PF.Heap.prototype._siftUp=function(a){var b,c,d,e,f,g,h;c=this._cmp,b=this._heap,d=b.length,e=a,f=b[a],g=2*a+1;while(g<d)h=g+1,h<d&&!c(b[g],b[h])&&(g=h),b[a]=b[g],a=g,g=2*a+1;b[a]=f,this._siftDown(e,a)},PF.AStarFinder=function(a){PF.BaseFinder.call(this),this.heuristic=a||PF.AStarFinder.manhattan},PF.AStarFinder.prototype=new PF.BaseFinder,PF.AStarFinder.prototype.constructor=PF.AStarFinder,PF.AStarFinder.prototype.init=function(a,b,c,d,e){PF.BaseFinder.prototype.init.call(this,a,b,c,d,e);var e=this.grid;this.openList=new PF.Heap(function(a,b){return e.getAttributeAt(a[0],a[1],"f")<e.getAttributeAt(b[0],b[1],"f")})},PF.AStarFinder.prototype.findPath=function(){var a,b,c,d,e=this.startX,f=this.startY,g=this.endX,h=this.endY,i=this.openList,j=this.grid,k;xOffsets=[-1,0,0,1],yOffsets=[0,-1,1,0],k=j.getNodeAt(e,f),k.g=0,k.f=0,i.push([e,f]),k.opened=!0;while(!i.isEmpty()){pos=i.pop(),a=pos[0],b=pos[1],j.setAttributeAt(a,b,"closed",!0);if(a==g&&b==h)return this._constructPath();for(var l=0;l<xOffsets.length;++l)c=a+xOffsets[l],d=b+yOffsets[l],j.isInside(c,d)&&j.isWalkableAt(c,d)&&this._inspectNodeAt(c,d,a,b)}return[]},PF.AStarFinder.prototype._constructPath=function(){var a=this.startX,b=this.startY,c,d,e=this.grid,f=[[this.endX,this.endY]];for(;;){c=f[0][0],d=f[0][1];if(c==a&&d==b)return f;f.unshift(e.getAttributeAt(c,d,"parent"))}return[]},PF.AStarFinder.prototype._inspectNodeAt=function(a,b,c,d){var e=this.grid,f=this.openList,g=e.getNodeAt(a,b);if(g.closed)return;g.opened||(g.opened=!0,f.push([a,b])),this._tryUpdate(a,b,c,d)},PF.AStarFinder.prototype._tryUpdate=function(a,b,c,d){var e=this.grid,f=e.getNodeAt(c,d),g=f.g+1;return node=e.getNodeAt(a,b),node.g===undefined||g<node.g?(node.parent=[c,d],node.g=g,node.h=this._calculateH(a,b),node.f=node.g+node.h,!0):!1},PF.AStarFinder.prototype._calculateH=function(a,b){var c=Math.abs(a-this.endX),d=Math.abs(b-this.endY);return this.heuristic(c,d)},PF.AStarFinder.manhattan=function(a,b){return a+b},PF.AStarFinder.euclidean=function(a,b){return Math.sqrt(a*a+b*b)},PF.AStarFinder.chebyshev=function(a,b){return Math.max(a,b)}